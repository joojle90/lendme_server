"use strict";
/**
 * Created by Joojle on 10/04/18.
 */
var express = require("express");
var q_log_1 = require("./q_log");
var router = express.Router();
var db = require('../../database/db.service');
var passport = require('passport');
var authentication = require('../../utils/authentication');
var jwt = require('jsonwebtoken');
var config = require('../../utils/config').SYSTEM_CONFIG;
var tokenList = {};
// get all log
router.get('/log', function (req, res) {
    db.getConnection(function (err, connection) {
        if (err) {
            res.status(500).send({ message: err });
        }
        else {
            var params_1 = req.query;
            var record = void 0, query_line_1 = "";
            record = "" + q_log_1.LOG_SELECTIVE;
            if (Object.keys(params_1).length > 0) {
                Object.keys(params_1).forEach(function (key, index) {
                    if (key === "dateStart") {
                        var criteria = params_1.dateStart === "" ? "" : " AND date(insert_date) >= " + ("'" + params_1.dateStart + "'");
                        query_line_1 += criteria;
                    }
                    if (key === "dateEnd") {
                        var criteria = params_1.dateEnd === "" ? "" : " AND date(insert_date) <= " + ("'" + params_1.dateEnd + "'");
                        query_line_1 += criteria;
                    }
                    if (key === "logId") {
                        var criteria = params_1.logId === "" ? "" : " AND log_id = " + ("'" + params_1.logId + "'");
                        query_line_1 += criteria;
                    }
                    if (key === "customerStatus") {
                        var criteria = params_1.customerStatus === "" ? "" : " AND customer_status = " + ("'" + params_1.customerStatus + "'");
                        query_line_1 += criteria;
                    }
                });
            }
            record += query_line_1;
            console.log("RECORD", record);
            connection.query(record, function (err, results) {
                connection.release();
                if (err) {
                    res.status(500).send({ message: err });
                }
                else {
                    res.send(results);
                }
            });
        }
    });
});
module.exports = router;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QXlCLElBQUcsTUFBSyxRQUFNLENBQUMsY0FBYyxNQUFJLENBQUEsQ0FBQzt3QkFDaEgsWUFBVSxJQUFJLFFBQVEsQ0FBQztvQkFDeEIsQ0FBQztnQkFDRixDQUFDLENBQUMsQ0FBQztZQUNKLENBQUM7WUFFRCxNQUFNLElBQUssWUFBVSxDQUFDO1lBQ3RCLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBRTlCLFVBQVUsQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLFVBQUMsR0FBUSxFQUFFLE9BQVk7Z0JBQy9DLFVBQVUsQ0FBQyxPQUFPLEVBQUUsQ0FBQztnQkFFckIsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztvQkFDVCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUMsQ0FBQyxDQUFDO2dCQUN0QyxDQUFDO2dCQUFDLElBQUksQ0FBQyxDQUFDO29CQUNQLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQ25CLENBQUM7WUFDRixDQUFDLENBQUMsQ0FBQztRQUNKLENBQUM7SUFDRixDQUFDLENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQyxDQUFDO0FBRUgsaUJBQVMsTUFBTSxDQUFDIiwiZmlsZSI6InJvdXRlcy9sb2cvbG9nLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDcmVhdGVkIGJ5IEpvb2psZSBvbiAxMC8wNC8xOC5cbiAqL1xuXG5pbXBvcnQgKiBhcyBleHByZXNzIGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgTE9HX1NFTEVDVElWRSB9IGZyb20gXCIuL3FfbG9nXCI7XG5cbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5cbmNvbnN0IGRiID0gcmVxdWlyZSgnLi4vLi4vZGF0YWJhc2UvZGIuc2VydmljZScpO1xuY29uc3QgcGFzc3BvcnQgPSByZXF1aXJlKCdwYXNzcG9ydCcpO1xuY29uc3QgYXV0aGVudGljYXRpb24gPSByZXF1aXJlKCcuLi8uLi91dGlscy9hdXRoZW50aWNhdGlvbicpO1xuXG5jb25zdCBqd3QgPSByZXF1aXJlKCdqc29ud2VidG9rZW4nKTtcbmNvbnN0IGNvbmZpZyA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL2NvbmZpZycpLlNZU1RFTV9DT05GSUc7XG5jb25zdCB0b2tlbkxpc3QgPSB7fTtcblxuLy8gZ2V0IGFsbCBsb2dcbnJvdXRlci5nZXQoJy9sb2cnLCAocmVxOiBhbnksIHJlczogYW55KSA9PiB7XG5cdGRiLmdldENvbm5lY3Rpb24oKGVycjogYW55LCBjb25uZWN0aW9uOiBhbnkpID0+IHtcblx0XHRpZiAoZXJyKSB7XG5cdFx0XHRyZXMuc3RhdHVzKDUwMCkuc2VuZCh7bWVzc2FnZTogZXJyfSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnN0IHBhcmFtcyA9IHJlcS5xdWVyeTtcblxuXHRcdFx0bGV0IHJlY29yZCwgcXVlcnlfbGluZSA9IFwiXCI7XG5cblx0XHRcdHJlY29yZCA9IGAkeyBMT0dfU0VMRUNUSVZFIH1gO1xuXG5cdFx0XHRpZihPYmplY3Qua2V5cyhwYXJhbXMpLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0T2JqZWN0LmtleXMocGFyYW1zKS5mb3JFYWNoKChrZXksIGluZGV4KSA9PiB7XG5cdFx0XHRcdFx0aWYgKGtleSA9PT0gXCJkYXRlU3RhcnRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3JpdGVyaWEgPSBwYXJhbXMuZGF0ZVN0YXJ0ID09PSBcIlwiID8gXCJcIiA6IFwiIEFORCBkYXRlKGluc2VydF9kYXRlKSA+PSBcIiArIChcIidcIiArIHBhcmFtcy5kYXRlU3RhcnQgKyBcIidcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBxdWVyeV9saW5lICs9IGNyaXRlcmlhO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09IFwiZGF0ZUVuZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjcml0ZXJpYSA9IHBhcmFtcy5kYXRlRW5kID09PSBcIlwiID8gXCJcIiA6IFwiIEFORCBkYXRlKGluc2VydF9kYXRlKSA8PSBcIiArIChcIidcIiArIHBhcmFtcy5kYXRlRW5kICsgXCInXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlfbGluZSArPSBjcml0ZXJpYTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXHRcdFx0XHRcdGlmIChrZXkgPT09IFwibG9nSWRcIikge1xuXHRcdFx0XHRcdFx0Y29uc3QgY3JpdGVyaWEgPSBwYXJhbXMubG9nSWQgPT09IFwiXCIgPyBcIlwiIDogXCIgQU5EIGxvZ19pZCA9IFwiICsgYCckeyBwYXJhbXMubG9nSWQgfSdgO1xuXHRcdFx0XHRcdFx0cXVlcnlfbGluZSArPSBjcml0ZXJpYTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKGtleSA9PT0gXCJjdXN0b21lclN0YXR1c1wiKSB7XG5cdFx0XHRcdFx0XHRjb25zdCBjcml0ZXJpYSA9IHBhcmFtcy5jdXN0b21lclN0YXR1cyA9PT0gXCJcIiA/IFwiXCIgOiBcIiBBTkQgY3VzdG9tZXJfc3RhdHVzID0gXCIgKyBgJyR7IHBhcmFtcy5jdXN0b21lclN0YXR1cyB9J2A7XG5cdFx0XHRcdFx0XHRxdWVyeV9saW5lICs9IGNyaXRlcmlhO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdHJlY29yZCArPSAgcXVlcnlfbGluZTtcblx0XHRcdGNvbnNvbGUubG9nKFwiUkVDT1JEXCIsIHJlY29yZCk7XG5cblx0XHRcdGNvbm5lY3Rpb24ucXVlcnkocmVjb3JkLCAoZXJyOiBhbnksIHJlc3VsdHM6IGFueSkgPT4ge1xuXHRcdFx0XHRjb25uZWN0aW9uLnJlbGVhc2UoKTtcblxuXHRcdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdFx0cmVzLnN0YXR1cyg1MDApLnNlbmQoe21lc3NhZ2U6IGVycn0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHJlcy5zZW5kKHJlc3VsdHMpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cdH0pO1xufSk7XG5cbmV4cG9ydCA9IHJvdXRlcjsiXX0=
